<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <!-- 行動裝置 RWD 必備 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>點餐系統 (主頁面) - 客製詞亦可顯示資料庫</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    h1, h2 {
      margin-bottom: 8px;
    }
    .section {
      border: 1px solid #ccc;
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    .output {
      margin-top: 10px;
      color: #333;
    }
    .highlight {
      color: green;
      font-weight: bold;
    }
    .error {
      color: red;
    }

    label {
      display: block;
      margin: 5px 0 2px;
      font-weight: bold;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      max-width: 300px;
      box-sizing: border-box;
      margin-bottom: 8px;
      padding: 6px;
    }
    button {
      margin: 5px 5px 5px 0;
      cursor: pointer;
    }

    /* Modal (彈出視窗) */
    #modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: none; /* 預設隱藏 */
      justify-content: center;
      align-items: center;
    }
    #database-modal {
      background-color: #fff;
      padding: 20px;
      border-radius: 6px;
      width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      position: relative;
    }
    #close-modal-btn {
      background-color: #999;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      position: absolute;
      right: 10px;
      top: 10px;
    }
    .item-box {
      border: 1px solid #ddd;
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 4px;
      position: relative;
    }

    /* 縮排一點方便區隔 */
    .db-section-title {
      margin: 14px 0 6px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 4px;
    }

    /* 狹窄螢幕 (行動裝置) */
    @media (max-width: 600px) {
      body {
        margin: 10px;
      }
      .section {
        padding: 10px;
      }
      #database-modal {
        width: 90%;
        padding: 10px;
      }
    }
  </style>
</head>
<body>

<h1>點餐系統 (主頁面)</h1>

<!-- 查看資料庫 (同時包含餐點 & 客製詞) -->
<button id="view-database-btn">查看資料庫</button>

<!-- 設定 (Setting) -->
<div class="section">
  <h2>設定 (Setting)</h2>
  <label for="item-name">餐點名稱:</label>
  <input type="text" id="item-name" placeholder="如：漢堡">

  <label for="item-price">價格:</label>
  <input type="number" id="item-price" placeholder="如：50">

  <button id="add-item-btn">新增餐點</button>
  <div class="output" id="setting-output"></div>
</div>

<!-- 客製詞設定 (Custom Keywords) -->
<div class="section">
  <h2>客製詞設定 (Custom Keywords)</h2>
  <label for="custom-word-input">客製詞:</label>
  <input type="text" id="custom-word-input" placeholder="如：辣、少冰、去冰">
  
  <button id="add-custom-word-btn">新增客製詞</button>
  <div class="output" id="custom-word-output"></div>
</div>

<!-- 簡易點餐 (用於測試) -->
<div class="section">
  <h2>簡易點餐測試</h2>
  <label for="order-input">想點的餐點 (可含客製詞):</label>
  <input type="text" id="order-input" placeholder="例如：漢堡辣 / 薯條去冰 (?)">

  <button id="order-btn">點餐</button>
  <div class="output" id="order-output"></div>
</div>

<!-- Modal (查看 & 管理資料庫) -->
<div id="modal-overlay">
  <div id="database-modal">
    <button id="close-modal-btn">關閉</button>
    
    <!-- 餐點清單 -->
    <h2 class="db-section-title">已建立的餐點</h2>
    <div id="menu-items-content"></div>
    <button id="clear-menuitems-btn" style="background-color:#e74c3c; color:#fff; border:none; padding:5px 10px; cursor:pointer;">
      清空餐點
    </button>

    <!-- 客製詞清單 -->
    <h2 class="db-section-title">已建立的客製詞</h2>
    <div id="custom-words-content"></div>
    <button id="clear-customwords-btn" style="background-color:#e74c3c; color:#fff; border:none; padding:5px 10px; cursor:pointer;">
      清空客製詞
    </button>
  </div>
</div>

<script>
/** 
 * 1. LocalStorage 資料結構
 *    - menuItems: [ { name, price, synonyms:[] }, ... ]
 *    - customWords: [ "辣", "去冰", "小辣", ... ]
 */
let menuItems = JSON.parse(localStorage.getItem("menuItems")) || [];
let customWords = JSON.parse(localStorage.getItem("customWords")) || [];

// 儲存函式
function saveMenuItems() {
  localStorage.setItem("menuItems", JSON.stringify(menuItems));
}
function saveCustomWords() {
  localStorage.setItem("customWords", JSON.stringify(customWords));
}

// 2. DOM 取得
const addItemBtn = document.getElementById("add-item-btn");
const itemNameInput = document.getElementById("item-name");
const itemPriceInput = document.getElementById("item-price");
const settingOutput = document.getElementById("setting-output");

const customWordInput = document.getElementById("custom-word-input");
const addCustomWordBtn = document.getElementById("add-custom-word-btn");
const customWordOutput = document.getElementById("custom-word-output");

const orderInput = document.getElementById("order-input");
const orderBtn = document.getElementById("order-btn");
const orderOutput = document.getElementById("order-output");

const viewDatabaseBtn = document.getElementById("view-database-btn");
const modalOverlay = document.getElementById("modal-overlay");
const databaseModal = document.getElementById("database-modal");
const menuItemsContent = document.getElementById("menu-items-content");
const customWordsContent = document.getElementById("custom-words-content");
const closeModalBtn = document.getElementById("close-modal-btn");
const clearMenuItemsBtn = document.getElementById("clear-menuitems-btn");
const clearCustomWordsBtn = document.getElementById("clear-customwords-btn");

//-------------------------------
// 3. 新增餐點
//-------------------------------
addItemBtn.addEventListener("click", () => {
  const name = itemNameInput.value.trim();
  const price = parseFloat(itemPriceInput.value);
  if (!name || isNaN(price)) {
    settingOutput.textContent = "請輸入正確的餐點名稱和價格。";
    settingOutput.classList.add("error");
    return;
  }
  settingOutput.classList.remove("error");

  const newItem = {
    name,
    price,
    synonyms: [name] // 預設把名稱當成相似詞
  };
  menuItems.push(newItem);
  saveMenuItems();

  settingOutput.textContent = `已新增餐點：${name}，價格：${price}`;
  itemNameInput.value = "";
  itemPriceInput.value = "";
});

//-------------------------------
// 4. 新增客製詞
//-------------------------------
addCustomWordBtn.addEventListener("click", () => {
  const word = customWordInput.value.trim();
  if (!word) {
    customWordOutput.textContent = "請輸入客製詞 (例如：辣)";
    customWordOutput.classList.add("error");
    return;
  }
  customWordOutput.classList.remove("error");

  if (!customWords.includes(word)) {
    customWords.push(word);
    saveCustomWords();
    customWordOutput.textContent = `已新增客製詞：「${word}」`;
  } else {
    customWordOutput.textContent = `客製詞「${word}」已存在。`;
  }
  customWordInput.value = "";
});

//-------------------------------
// 5. 簡易點餐 (測試區)
//-------------------------------
orderBtn.addEventListener("click", () => {
  const userInput = orderInput.value.trim();
  orderOutput.innerHTML = "";
  if (!userInput) {
    orderOutput.textContent = "請輸入想點的餐點 (可含客製詞)";
    orderOutput.classList.add("error");
    return;
  }
  orderOutput.classList.remove("error");

  // 偵測餐點 (部分比對)
  let matchedItem = null;
  for (let item of menuItems) {
    for (let syn of item.synonyms) {
      if (userInput.includes(syn)) {
        matchedItem = item;
        break;
      }
    }
    if (matchedItem) break;
  }

  // 偵測客製詞
  let foundCustomWords = [];
  for (let w of customWords) {
    if (userInput.includes(w)) {
      foundCustomWords.push(w);
    }
  }

  if (!matchedItem) {
    // 沒找到任何餐點
    orderOutput.textContent = `無法匹配任何餐點。偵測到客製詞：${foundCustomWords.join("、") || "無"}`;
    orderOutput.classList.add("error");
  } else {
    // 顯示匹配結果
    orderOutput.innerHTML = `匹配到餐點：<span class="highlight">${matchedItem.name}</span><br>`;
    if (foundCustomWords.length > 0) {
      orderOutput.innerHTML += `偵測到客製詞：<span class="highlight">${foundCustomWords.join("、")}</span>`;
    } else {
      orderOutput.innerHTML += "未偵測到任何客製詞。";
    }
  }
  orderInput.value = "";
});

//-------------------------------
// 6. 查看資料庫 (Modal)
//-------------------------------
viewDatabaseBtn.addEventListener("click", () => {
  updateDatabaseModalContent();
  modalOverlay.style.display = "flex";
});

// 關閉
closeModalBtn.addEventListener("click", () => {
  modalOverlay.style.display = "none";
});

//-------------------------------
// 7. 在 Modal 裏同時顯示「餐點」與「客製詞」的清單
//-------------------------------
function updateDatabaseModalContent() {
  // (a) 顯示餐點
  menuItemsContent.innerHTML = "";
  if (menuItems.length === 0) {
    menuItemsContent.textContent = "目前沒有任何餐點。";
  } else {
    menuItems.forEach((item, idx) => {
      const box = document.createElement("div");
      box.className = "item-box";
      box.innerHTML = `
        <strong>餐點${idx+1}：</strong> ${item.name} (NT$${item.price})<br>
        <em>相似詞：</em> ${item.synonyms.join(", ")}
      `;
      menuItemsContent.appendChild(box);
    });
  }

  // (b) 顯示客製詞
  customWordsContent.innerHTML = "";
  if (customWords.length === 0) {
    customWordsContent.textContent = "目前沒有任何客製詞。";
  } else {
    customWords.forEach((word, i) => {
      const div = document.createElement("div");
      div.className = "item-box";
      div.textContent = `客製詞${i+1}：${word}`;
      customWordsContent.appendChild(div);
    });
  }
}

//-------------------------------
// 8. 清空「餐點」 & 「客製詞」按鈕
//-------------------------------
clearMenuItemsBtn.addEventListener("click", () => {
  const sure = confirm("確定要清空所有餐點嗎？此操作無法復原！");
  if (sure) {
    localStorage.removeItem("menuItems");
    menuItems = [];
    updateDatabaseModalContent();
    alert("餐點已清空。");
  }
});

clearCustomWordsBtn.addEventListener("click", () => {
  const sure = confirm("確定要清空所有客製詞嗎？此操作無法復原！");
  if (sure) {
    localStorage.removeItem("customWords");
    customWords = [];
    updateDatabaseModalContent();
    alert("客製詞已清空。");
  }
});
</script>

</body>
</html>